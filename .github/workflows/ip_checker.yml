name: IP 检测与处理脚本

on:
  workflow_dispatch: # 手动触发
  schedule:
    - cron: '0 */3 * * *' # 每3小时运行一次（UTC时间，注意时区）

permissions:
  contents: write   # 允许读写仓库内容
  actions: write    # 允许管理Actions本身

jobs:
  run-script:
    runs-on: windows-latest  # 因为有 .exe，建议用windows runner
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 检查Python环境
        run: python --version

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install dnspython requests

      - name: 检查CloudflareScanner.exe是否存在
        run: |
          if not exist CloudflareScanner\CloudflareScanner.exe (
            echo "CloudflareScanner.exe 不存在"
            exit /b 1
          ) else (
            echo "CloudflareScanner.exe 存在"
          )

      - name: 运行脚本
        run: python DNS2Geo.py
